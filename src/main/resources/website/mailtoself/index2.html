<!DOCTYPE html>
<html>
<!--#include file="includes/header.html" -->


<script>
    function init() {
        renderTabs();
    }

    function renderTabs() {
        var accountNames = Accounts.getAccountNames();
        if (accountNames && accountNames.length > 1) {
            for (var i = 0; i < accountNames.length; i++) {
                var className = i == 0 ? "activeTab" : "";
                var tabHtml = "<div "
                    + "class='tab " + className + "' "
                    + "data-index='" + i + "'"
                    + "onclick='javascript:toggleTab(this);'>"
                    + accountNames[i] + "</div>";
                document.getElementById("tabs").innerHTML += tabHtml;
            }
        }
    }


    function toggleTab(clickedTab) {
        //Remove active tab class from previously selected tab
        document.getElementsByClassName("activeTab")[0].classList.remove("activeTab");
        //Set argument tab to be active tab
        clickedTab.classList.add('activeTab');
    }


    function getSelectedTabIndex() {
        var index = document.getElementsByClassName("activeTab")[0].dataset.index;
        return parseInt(index);
    }


    function send() {
        //The the message to email
        var mailContent = document.getElementById("mailContent").value;
        //If there was no message to send
        if (!mailContent) {
            return;
        }
        var xhr = new XMLHttpRequest();
        //Set callback to invoke on successful response from server
        xhr.onload = function () {
            //Empty message input box
            document.getElementById("mailContent").value = "";
            //Show server response to user
            notify(xhr.responseText);
            //Put focus in input box for user to start typing a new message
            document.getElementById("mailContent").focus();
        };
        //Create request
        xhr.open("post", "/call/mailMe", true);
        var index = getSelectedTabIndex();
        var userName = Accounts.getUserName(index);
        var password = Accounts.getEncryptedPassword(index);
        //Send request to server
        xhr.send(
            "Message=" + encodeURIComponent(mailContent)
            + "&Username=" + encodeURIComponent(userName)
            + "&Password=" + encodeURIComponent(password)
        );
    }
</script>


<body>
<h1>Mail To Self</h1>
<div id="tabs"></div>

<textarea
        type="text"
        id="mailContent"
        onkeypress="if (event.keyCode===13) send();"
        placeholder="Mail content here...">
</textarea>

<button
        type="button"
        onClick="send();">SEND
</button>


<script>init();</script>
</body>
</html>